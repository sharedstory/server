<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>MapView.pde</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>MapView.pde</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <h1>MapView</h1>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>The MapView class is responsible for rendering the whole map and managing
mouse-based interaction. Classes describe kinds of things; instances represent things themselves. 
We only create one instance of MapView (in <a href="hospitals.html#section-4">hospitals.pde</a>), 
but we will create many instances of other classes. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kd">class</span> <span class="nc">MapView</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <h3>Instance variables</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Each instance of MapView will have its own copy of these variables. 
First, we have a bunch of integers (<code>int</code>) which record the number of rows and columns in the map, the x and y 
coordinates of the map on the screen, the width and height of the map on the 
screen, and the width and height of each cell in the map.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kt">int</span> <span class="n">cols</span><span class="o">,</span> <span class="n">rows</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">map_width</span><span class="o">,</span> <span class="n">map_height</span><span class="o">,</span> <span class="n">cell_width</span><span class="o">,</span> <span class="n">cell_height</span><span class="o">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p><code>cell_views</code> will be a two-dimensional array of MapCellViews, each of which will be 
responsible for rendering one cell in the map. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">MapCellView</span><span class="o">[][]</span> <span class="n">cell_views</span><span class="o">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p><code>tiles</code> will hold an array of images. These will be used by MapCellViews during rendering, 
bit it would be pretty inefficient to ask each MapCellView to re-load the same images. 
So instead the MapView will load them once, and make them available to each MapCellView.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">PImage</span><span class="o">[]</span> <span class="n">tiles</span><span class="o">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p><code>active_cell_model</code> will be a reference to a particular cell model. This will be used when 
the player drags a hospital around the screen. When the mouse is dragged over a new cell, we will
need to remember where the hospital used to be so that we can move it from there to the new
cell.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">MapCellModel</span> <span class="n">active_cell_model</span><span class="o">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <h3>Constructor</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>A class constructor describes how to make a new instance. For MapView, you need to provide
integers for the number of columns and rows, the x and y screen coordinates, and the width
and height of the map on the screen. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">MapView</span><span class="o">(</span><span class="kt">int</span> <span class="n">_cols</span><span class="o">,</span> <span class="kt">int</span> <span class="n">_rows</span><span class="o">,</span> <span class="kt">int</span> <span class="n">_x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">_y</span><span class="o">,</span> <span class="kt">int</span> <span class="n">_map_width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">_map_height</span><span class="o">)</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>Save the arguments in instance variables so we can access them later.
This is a common pattern you'll see in other classes.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">cols</span> <span class="o">=</span> <span class="n">_cols</span><span class="o">;</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">_rows</span><span class="o">;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">_x</span><span class="o">;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">_y</span><span class="o">;</span>
    <span class="n">map_width</span> <span class="o">=</span> <span class="n">_map_width</span><span class="o">;</span>
    <span class="n">map_height</span> <span class="o">=</span> <span class="n">_map_height</span><span class="o">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Calculate the cell width and height using the other parameters. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">cell_width</span> <span class="o">=</span> <span class="n">map_width</span> <span class="o">/</span> <span class="n">cols</span><span class="o">;</span>
    <span class="n">cell_height</span> <span class="o">=</span> <span class="n">map_height</span> <span class="o">/</span> <span class="n">rows</span><span class="o">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Create a 2d array to hold a bunch of <a href="MapCellView.html">MapCellViews</a>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">cell_views</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapCellView</span><span class="o">[</span><span class="n">rows</span><span class="o">][</span><span class="n">cols</span><span class="o">];</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Load the images we will need for rendering tiles. (These live in the <code>data</code> folder.)
<br />
<img src="tiles/field.png" width="32px">
<img src="tiles/road.png" width="32px">
<img src="tiles/forest.png" width="32px">
<img src="tiles/town.png" width="32px">
<img src="tiles/hospital.png" width="32px"></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">tiles</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PImage</span><span class="o">[]</span> <span class="o">{</span>
      <span class="n">loadImage</span><span class="o">(</span><span class="s">&quot;tiles/field.png&quot;</span><span class="o">),</span> 
      <span class="n">loadImage</span><span class="o">(</span><span class="s">&quot;tiles/road.png&quot;</span><span class="o">),</span> 
      <span class="n">loadImage</span><span class="o">(</span><span class="s">&quot;tiles/forest.png&quot;</span><span class="o">),</span>
      <span class="n">loadImage</span><span class="o">(</span><span class="s">&quot;tiles/town.png&quot;</span><span class="o">),</span>
      <span class="n">loadImage</span><span class="o">(</span><span class="s">&quot;tiles/hospital.png&quot;</span><span class="o">)</span>
    <span class="o">};</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Go through every row...</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>and every column... </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cols</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>and create an instance of a <a href="MapCellView.html">MapCellView</a>,
providing x, y, width, and height coordinates (as well as the tile images). 
This <a href="MapCellView.html">MapCellView</a> will own that little patch of screen. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">cell_views</span><span class="o">[</span><span class="n">j</span><span class="o">][</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapCellView</span><span class="o">(</span>
          <span class="n">x</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">cell_width</span><span class="o">,</span> 
          <span class="n">y</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">cell_height</span><span class="o">,</span> 
          <span class="n">cell_width</span><span class="o">,</span> 
          <span class="n">cell_height</span><span class="o">,</span> 
          <span class="n">tiles</span>
        <span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <h3>Render</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p><code>render</code> is the most important method of every view--<code>render</code> kicks off the 
whole process of rendering the view. When <code>render</code> is called, a model must be provided, 
so we can access the state data to be rendered.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kt">void</span> <span class="nf">render</span><span class="o">(</span><span class="n">MapModel</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>Most of the work is delegated to the individual MapCellViews, so we go through 
every row...</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>and every column...</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cols</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>look up the right <a href="MapCellView.html">MapCellView</a>, and tell it to 
<a href="MapCellView.html#section-11">render</a>. To do this, we also need to provide
the right <a href="MapCellModel.html">MapCellModel</a>, but that's getting ahead of ourselves.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">cell_views</span><span class="o">[</span><span class="n">j</span><span class="o">][</span><span class="n">i</span><span class="o">].</span><span class="na">render</span><span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="na">cell_models</span><span class="o">[</span><span class="n">j</span><span class="o">][</span><span class="n">i</span><span class="o">]);</span>
      <span class="o">}</span>
    <span class="o">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>Set the text color to black.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">fill</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Write some basic instructions at the top right corner of the screen,</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">text</span><span class="o">(</span><span class="s">&quot;Place the hospitals&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">+</span><span class="n">map_width</span> <span class="o">-</span> <span class="mi">140</span><span class="o">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">20</span><span class="o">);</span>
    <span class="n">text</span><span class="o">(</span><span class="s">&quot;so they serve the towns&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">+</span><span class="n">map_width</span> <span class="o">-</span> <span class="mi">140</span><span class="o">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">32</span><span class="o">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>and write the score and number of hospitals remaining. Remember, <code>render</code> gets called
over and over many times per second, so as long as the model always knows the score, 
it will be shown correctly. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">text</span><span class="o">(</span><span class="s">&quot;Score: &quot;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="na">score</span><span class="o">(),</span> <span class="n">x</span><span class="o">+</span><span class="n">map_width</span> <span class="o">-</span> <span class="mi">140</span><span class="o">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">44</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="na">hospitals_left</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">text</span><span class="o">(</span><span class="s">&quot;Hospitals left: &quot;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="na">hospitals_left</span><span class="o">(),</span> <span class="n">x</span><span class="o">+</span><span class="n">map_width</span> <span class="o">-</span> <span class="mi">140</span><span class="o">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">56</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <h2>Event handlers</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>Remember how <a href="hospitals.html#section-10">hospitals.pde</a> delegated events to the view?
Now we have to describe what should happen when user interaction events occur. In the three
functions below, we make it possible for the user to place new hospitals by clicking on empty map cells,
and to move hospitals around by clicking, dragging, and releasing cells containing hospitals. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <h3>handle_press</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>When the mouse is pressed over a cell, </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kt">void</span> <span class="nf">handle_press</span><span class="o">(</span><span class="n">MapModel</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>Get the map coordinates of the cell under the mouse.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="kt">int</span><span class="o">[]</span> <span class="n">index</span> <span class="o">=</span> <span class="n">get_mouse_cell_index</span><span class="o">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>Print a debugging statement to the console. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">println</span><span class="o">(</span><span class="s">&quot;PRESS&quot;</span><span class="o">,</span> <span class="n">index</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">index</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>Make a variable called <code>cell_model</code> referring to a particular <a href="MapCellModel.html">MapCellModel</a>. 
(Use the map coordinates to look up the right cell model.)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">MapCellModel</span> <span class="n">cell_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">cell_models</span><span class="o">[</span><span class="n">index</span><span class="o">[</span><span class="mi">1</span><span class="o">]][</span><span class="n">index</span><span class="o">[</span><span class="mi">0</span><span class="o">]];</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>If the cell is free (it has no towns or hospitals), and there are still more 
hospitals available to be placed,</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="o">(</span><span class="n">cell_model</span><span class="o">.</span><span class="na">is_free</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">model</span><span class="o">.</span><span class="na">num_hospitals</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">model</span><span class="o">.</span><span class="na">hospitals_allowed</span><span class="o">)</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>then add a hospital here, remember this cell as the active cell model, 
and update the cell distances. (<a href="MapModel.html#section-34">model.update_cell_distances</a> computes each cell's distance
to the nearest hospital.)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">cell_model</span><span class="o">.</span><span class="na">add_hospital</span><span class="o">();</span>
        <span class="n">active_cell_model</span> <span class="o">=</span> <span class="n">cell_model</span><span class="o">;</span>
        <span class="n">model</span><span class="o">.</span><span class="na">update_cell_distances</span><span class="o">();</span>
    <span class="o">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>Otherwise, if there's a hospital here, </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">cell_model</span><span class="o">.</span><span class="na">has_hospital</span><span class="o">)</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>remember this  as the active cell model.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">active_cell_model</span> <span class="o">=</span> <span class="n">cell_model</span><span class="o">;</span>
    <span class="o">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>Finally, in case neither of the previous conditions was true, clear <code>active_cell_model</code> to indicate
that there is no active cell.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">else</span> <span class="o">{</span>
      <span class="n">active_cell_model</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> 
    <span class="o">}</span>
  <span class="o">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <h3>handle_drag</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>When when the mouse moves while pressed, </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kt">void</span> <span class="nf">handle_drag</span><span class="o">(</span><span class="n">MapModel</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>If the mouse is over the map, </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">if</span> <span class="o">(</span><span class="n">mouse_over_map</span><span class="o">())</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <p>Get the map coordinates of the cell under the mouse, print a debugging statement to the console,
and create a reference to the relevant cell model (same as the previous function). </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="kt">int</span><span class="o">[]</span> <span class="n">index</span> <span class="o">=</span> <span class="n">get_mouse_cell_index</span><span class="o">();</span>
      <span class="n">println</span><span class="o">(</span><span class="s">&quot;DRAG&quot;</span><span class="o">,</span> <span class="n">index</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">index</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
      <span class="n">MapCellModel</span> <span class="n">cell_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">cell_models</span><span class="o">[</span><span class="n">index</span><span class="o">[</span><span class="mi">1</span><span class="o">]][</span><span class="n">index</span><span class="o">[</span><span class="mi">0</span><span class="o">]];</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>If there is an active cell, and it's not the same as the cell presently under the mouse, and 
if the cell presently under the mouse is free,</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">if</span> <span class="o">(</span><span class="n">active_cell_model</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">cell_model</span> <span class="o">!=</span> <span class="n">active_cell_model</span> <span class="o">&amp;&amp;</span> <span class="n">cell_model</span><span class="o">.</span><span class="na">is_free</span><span class="o">())</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>then move the hospital from the active cell to this cell, make this the active cell, and 
update the cell distances. (A hospital's position has changed, so we need to re-compute every 
cell's distance to the closest hospital.)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="n">active_cell_model</span><span class="o">.</span><span class="na">remove_hospital</span><span class="o">();</span>
       <span class="n">cell_model</span><span class="o">.</span><span class="na">add_hospital</span><span class="o">();</span>
       <span class="n">active_cell_model</span> <span class="o">=</span> <span class="n">cell_model</span><span class="o">;</span>
       <span class="n">model</span><span class="o">.</span><span class="na">update_cell_distances</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <h3>handle_release</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>When the user releases the mouse button, clear <code>active_cell_model</code> to indicate that there is no
active cell (in particular, no hospitals should be getting moved around). </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kt">void</span> <span class="nf">handle_release</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;RELEASE&quot;</span><span class="o">);</span>
    <span class="n">active_cell_model</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> 
  <span class="o">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <h2>Helpers</h2>
<p>In the methods above, there were some tasks that had to be done several times. We were able to simplify
the code by pulling this work out into helpers. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <h3>get_mouse_cell_index</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      <p>Some simple math allows us to convert screen coordinates into map coordinates. The model doesn't know
anything about where on screen the map is getting rendered (or whether it's getting rendered at all), 
so we want to work with map coordinates instead. Processing always provides <code>mouseX</code> and <code>mouseY</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kt">int</span><span class="o">[]</span> <span class="nf">get_mouse_cell_index</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="o">(</span><span class="n">mouseX</span> <span class="o">-</span> <span class="n">x</span><span class="o">)</span> <span class="o">/</span> <span class="n">cell_width</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="o">(</span><span class="n">mouseY</span> <span class="o">-</span> <span class="n">y</span><span class="o">)</span> <span class="o">/</span> <span class="n">cell_height</span><span class="o">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <p>We also want to ensure that we never return invalid coordinates, so constrain the return values
to be between 0 and <code>rows - 1</code> or <code>cols - 1</code>. Then we return an array with two integers. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="kt">int</span><span class="o">[]</span> <span class="n">cell</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span><span class="n">max</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">min</span><span class="o">(</span><span class="n">cols</span><span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="n">i</span><span class="o">)),</span> <span class="n">max</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">min</span><span class="o">(</span><span class="n">rows</span><span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="n">j</span><span class="o">))};</span>
    <span class="k">return</span> <span class="n">cell</span><span class="o">;</span>
  <span class="o">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <h3>mouse_over_map</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      <p>Returns a boolean (<code>true</code> or <code>false</code>) indicating whether the mouse is over the map. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="kt">boolean</span> <span class="nf">mouse_over_map</span><span class="o">()</span> <span class="o">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      <p>For x and y, check that the mouse position is big enough but not too big.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">return</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">mouseX</span> <span class="o">&amp;&amp;</span> <span class="n">mouseX</span> <span class="o">&lt;</span> <span class="n">x</span><span class="o">+</span><span class="n">map_width</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">mouseY</span> <span class="o">&amp;&amp;</span> <span class="n">mouseY</span> <span class="o">&lt;</span> <span class="n">y</span><span class="o">+</span><span class="n">map_height</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      <h2>Next up...</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>Before we go on, I would like to point out that our work here was made much easier because
we had model methods like <a href="MapModel.html#section-32">model.score()</a> and 
<a href="MapModel.html#section-34">model.update_cell_distances()</a> to do the
hard work for us. This is another layer of modularity. In earlier versions, this file
was a lot messier--whenever possible, it's a good idea to <strong>refactor</strong> your code and move complexity
into the model. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <p>Now let's dive one layer deeper into <a href="MapModel.html">MapModel</a>. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
